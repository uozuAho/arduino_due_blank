cmake_minimum_required (VERSION 2.6)
project (ArduinoDue_blank)

#-----------------------------------------------------
# Source lists

# Manually listing all source files is apparently the recommended way.
# FIXME: Manual anything is prone to error. Target-specific source
# lists should be easy to generate. Look into Cmake's GLOB ability
set ( my_static_lib_sources
        my_static_lib/my_static_lib.h
        my_static_lib/my_static_lib_conf.h
        my_static_lib/my_static_lib_s1.c )

# Including the autogenerated _all_tests.c here
set ( tests_sources
        tests/TestProductionCode.c
        tests/TestProductionCode2.c
        tests/_all_tests.c
        tests/_all_tests_main.c )

set ( test_harness_sources
        test_harness/Unity/unity.c
        test_harness/Unity/unity.h
        test_harness/Unity/unity_conf.h
        test_harness/Unity/unity_fixture.c
        test_harness/Unity/unity_fixture.h
        test_harness/Unity/unity_fixture_internals.h
        test_harness/Unity/unity_fixture_malloc_overrides.h
        test_harness/Unity/unity_internals.h )

# FIXME:
# This is shit. Setting target-specific include dirs is too much hassle
# target_include_directories needs a 'PRIVATE' or something specifier before
# each dir. WTF?
include_directories (
        arduino_core/include
        arduino_core/variants/arduino_due_x
        device_libs/CMSIS/CMSIS/Include
        device_libs/CMSIS/Device/ATMEL
        device_libs/libsam
        src
        my_static_lib
        test_harness/Unity )

#-----------------------------------------------------
# UnitTests_host configuration
set ( UnitTests_host_sources
        ${my_static_lib_sources}
        ${tests_sources}
        ${test_harness_sources}
        src/ProductionCode.c
        src/ProductionCode.h
        src/ProductionCode2.c
        src/ProductionCode2.h )

add_executable(UnitTests_host
        ${UnitTests_host_sources})

# FIXME:
# This is shit. What a cumbersome way to do a simple thing!
set_target_properties (UnitTests_host PROPERTIES COMPILE_DEFINITIONS "TARGET_HOST")
set_target_properties (UnitTests_host PROPERTIES COMPILE_FLAGS "-Wall")


